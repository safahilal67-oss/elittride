<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>شركة Elite Trade | بوابة الإدارة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0b2c47;
      --primary-2: #154f79;
      --accent: #ff6b35;
      --success: #2ecc71;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #f8f9fa;
      --dark: #343a40;
      --bg-grad: linear-gradient(135deg, var(--primary), var(--primary-2));
      --card-bg: #ffffff;
      --text-primary: #333333;
      --text-secondary: #6c757d;
      --shadow: 0 10px 30px rgba(0,0,0,0.15);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Tajawal', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg-grad);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      line-height: 1.6;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 1000px;
      gap: 20px;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 100%;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .glass-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
      transform: rotate(30deg);
      pointer-events: none;
    }
    
    header { 
      text-align: center; 
      padding: 20px; 
      margin-bottom: 20px;
    }
    
    .logo {
      font-size: 2.8rem;
      margin-bottom: 15px;
      font-weight: 800;
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .logo i {
      font-size: 2.5rem;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    h2 {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 1.8rem;
    }
    
    .form-group {
      margin-bottom: 25px;
      position: relative;
    }
    
    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    label i {
      color: var(--accent);
    }
    
    .input-with-icon {
      position: relative;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 16px;
      transition: var(--transition);
      background: var(--light);
      color: var(--text-primary);
      font-family: inherit;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
      transform: translateY(-2px);
    }
    
    .toggle-password {
      position: absolute;
      top: 50%;
      left: 15px;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
      transition: var(--transition);
      padding: 5px;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .toggle-password:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--accent);
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 16px 28px;
      background: linear-gradient(to right, var(--primary), var(--primary-2));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 14px rgba(0, 0, 0, 0.2);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-primary {
      background: linear-gradient(to right, var(--primary), var(--primary-2));
    }
    
    .btn-success {
      background: linear-gradient(to right, var(--success), #27ae60);
    }
    
    .btn-warning {
      background: linear-gradient(to right, var(--warning), #e67e22);
    }
    
    .btn-info {
      background: linear-gradient(to right, #3498db, #2980b9);
    }
    
    .btn-danger {
      background: linear-gradient(to right, var(--danger), #c0392b);
    }
    
    .progress-bar {
      height: 6px;
      width: 100%;
      background: #e2e8f0;
      border-radius: 3px;
      overflow: hidden;
      margin: 15px 0;
      display: none;
    }
    
    .progress-bar .progress {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, var(--accent), var(--primary));
      border-radius: 3px;
      transition: width 0.4s ease;
    }
    
    .result-container {
      margin-top: 30px;
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    .result-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .result-table th {
      background: linear-gradient(to right, var(--primary), var(--primary-2));
      color: white;
      padding: 15px;
      text-align: right;
      font-weight: 600;
    }
    
    .result-table td {
      padding: 15px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .result-table tr:last-child td {
      border-bottom: none;
    }
    
    .result-table tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      background: var(--success);
    }
    
    .notification.error {
      background: var(--danger);
    }
    
    .notification.info {
      background: #3498db;
    }
    
    .help-trigger {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      background: linear-gradient(to right, var(--primary), var(--primary-2));
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 900;
      transition: var(--transition);
    }
    
    .help-trigger:hover {
      transform: scale(1.1) rotate(15deg);
    }
    
    .help-panel {
      position: fixed;
      bottom: 90px;
      left: 20px;
      width: 320px;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      z-index: 900;
      transform: translateY(100%);
      opacity: 0;
      transition: var(--transition);
    }
    
    .help-panel.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .help-panel h3 {
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .help-panel ul {
      list-style: none;
      padding: 0;
    }
    
    .help-panel li {
      padding: 10px 0;
      border-bottom: 1px solid #f1f1f1;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .help-panel li:last-child {
      border-bottom: none;
    }
    
    .help-panel li i {
      color: var(--accent);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @media (min-width: 992px) {
      .container {
        flex-direction: row;
        align-items: flex-start;
      }
      
      .card-half {
        width: 48%;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .glass-card {
        padding: 20px;
      }
      
      .logo {
        font-size: 2.2rem;
      }
      
      .actions {
        grid-template-columns: 1fr;
      }
      
      .help-panel {
        width: 280px;
        left: 10px;
      }
    }
    
    .lang-switch {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .lang-btn {
      background: none;
      border: 2px solid var(--primary);
      color: var(--primary);
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      font-size: 14px;
    }
    
    .lang-btn.active {
      background: var(--primary);
      color: white;
    }
    
    .actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 25px;
    }
    
    .muted {
      color: var(--text-secondary);
      font-size: 14px;
      text-align: center;
      margin-top: 20px;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      background: #f1f5f9;
      border-radius: 12px;
      padding: 5px;
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-radius: 8px;
      text-align: center;
      flex: 1;
      font-weight: 600;
      transition: var(--transition);
    }
    
    .tab.active {
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .admin-section {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 2px dashed var(--accent);
    }
    
    .client-list {
      max-height: 300px;
      overflow-y: auto;
      margin: 15px 0;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 10px;
    }
    
    .client-item {
      padding: 10px;
      border-bottom: 1px solid #f1f1f1;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .client-item:hover {
      background: #f9f9f9;
    }
    
    .client-item:last-child {
      border-bottom: none;
    }

    .editable-field {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 8px 12px;
      margin: 5px 0;
      min-height: 40px;
      display: flex;
      align-items: center;
    }
    
    .editable-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    }
    
    .admin-result-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .admin-result-table th {
      background: linear-gradient(to right, var(--primary), var(--primary-2));
      color: white;
      padding: 12px 15px;
      text-align: right;
      font-weight: 600;
    }
    
    .admin-result-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .admin-result-table tr:last-child td {
      border-bottom: none;
    }
    
    .admin-result-table input,
    .admin-result-table textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      font-size: 14px;
    }
    
    .admin-result-table input:focus,
    .admin-result-table textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
    }
    
    .admin-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }
  </style>
</head>
<body>

  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notification-text"></span>
  </div>

  <div class="help-trigger" id="help-trigger">
    <i class="fas fa-question"></i>
  </div>

  <div class="help-panel" id="help-panel">
    <h3><i class="fas fa-info-circle"></i> <span id="helpTitle">كيف تستخدم النظام</span></h3>
    <ul>
      <li><i class="fas fa-key"></i> <span id="help1">أدخل كلمة المرور الخاصة بك</span></li>
      <li><i class="fas fa-search"></i> <span id="help2">اضغط على زر البحث</span></li>
      <li><i class="fas fa-copy"></i> <span id="help3">استخدم الأزرار للنسخ أو الطباعة</span></li>
      <li><i class="fas fa-share-alt"></i> <span id="help4">شارك النتائج عبر واتساب</span></li>
    </ul>
  </div>

  <div class="container">
    <div class="glass-card">
      <header>
        <div class="logo">
          <i class="fas fa-building"></i>
          <span id="companyName">Elite Trade</span>
        </div>
        <h2 id="title">بوابة الإدارة</h2>
      </header>

      <div class="tabs">
        <div class="tab active" data-tab="search" id="searchTabLabel">بحث العملاء</div>
        <div class="tab" data-tab="admin" id="adminTabLabel">لوحة التحكم</div>
      </div>

      <div class="tab-content active" id="searchTab">
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="ar">العربية</button>
          <button class="lang-btn" data-lang="en">English</button>
          <button class="lang-btn" data-lang="fr">Français</button>
          <button class="lang-btn" data-lang="ru">Русский</button>
          <button class="lang-btn" data-lang="id">Indonesia</button>
        </div>

        <div id="searchSection">
          <div class="form-group">
            <label for="userPassword">
              <i class="fas fa-lock"></i>
              <span id="userPassLabel">كلمة المرور الخاصة بك</span>
            </label>
            <div class="input-with-icon">
              <input type="password" id="userPassword" autocomplete="one-time-code" placeholder="أدخل كلمة المرور الخاصة بك" />
              <button class="toggle-password" id="toggleUser">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <button id="searchBtn" class="btn btn-primary">
            <i class="fas fa-search"></i>
            <span id="searchText">بحث</span>
          </button>

          <div class="progress-bar" id="progressBar">
            <div class="progress"></div>
          </div>

          <div id="status" class="status"></div>
        </div>

        <div class="result-container" id="resultContainer">
          <div id="result"></div>

          <div class="actions">
            <button id="copyBtn" class="btn btn-success">
              <i class="fas fa-copy"></i>
              <span id="copyText">نسخ البيانات</span>
            </button>
            <button id="printBtn" class="btn btn-warning">
              <i class="fas fa-print"></i>
              <span id="printText">طباعة</span>
            </button>
            <button id="whatsappBtn" class="btn btn-info">
              <i class="fab fa-whatsapp"></i>
              <span id="whatsappText">واتساب</span>
            </button>
          </div>
        </div>

        <p class="muted" id="privacyNote">
          <i class="fas fa-shield-alt"></i>
          <span id="privacyText">لن يتم حفظ بياناتك في هذا الموقع.</span>
        </p>
      </div>

      <div class="tab-content" id="adminTab">
        <h3><i class="fas fa-cogs"></i> <span id="adminPanelTitle">لوحة تحكم المسؤول</span></h3>
        
        <div class="form-group">
          <label for="adminPassword">
            <i class="fas fa-lock"></i>
            <span id="adminPassLabel">كلمة مرور المسؤول</span>
          </label>
          <input type="password" id="adminPassword" placeholder="أدخل كلمة مرور المسؤول">
        </div>
        
        <button id="adminLoginBtn" class="btn btn-primary">
          <i class="fas fa-sign-in-alt"></i>
          <span id="adminLoginText">تسجيل الدخول</span>
        </button>
        
        <div id="adminPanel" style="display: none;">
          <div class="admin-section">
            <h4><i class="fas fa-search"></i> <span id="searchClientTitle">بحث عن العميل</span></h4>
            
            <div class="form-group">
              <label for="clientSearch">
                <i class="fas fa-key"></i>
                <span id="clientSearchLabel">كلمة مرور العميل</span>
              </label>
              <input type="text" id="clientSearch" placeholder="ابحث بكلمة مرور العميل...">
            </div>
            
            <button id="searchClientBtn" class="btn btn-info">
              <i class="fas fa-search"></i>
              <span id="searchClientText">بحث</span>
            </button>
            
            <div class="progress-bar" id="adminProgressBar">
              <div class="progress"></div>
            </div>
            
            <div id="adminStatus" class="status"></div>
            
            <div class="client-info" id="clientInfo" style="display: none; margin-top: 20px;">
              <h4><i class="fas fa-user"></i> <span id="clientInfoTitle">معلومات العميل</span></h4>
              
              <div id="adminResult"></div>

              <div class="admin-actions">
                <button id="updateClientBtn" class="btn btn-success">
                  <i class="fas fa-save"></i>
                  <span id="updateClientText">حفظ التعديلات</span>
                </button>
              </div>
              
              <div class="progress-bar" id="updateProgressBar">
                <div class="progress"></div>
              </div>

              <div id="updateStatus"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="glass-card">
      <header>
        <h2><i class="fas fa-bell"></i> <span id="notificationsTitle">إشعارات التعديلات</span></h2>
        <p><span id="notificationsSubtitle">سجل إشعارات التعديلات المرسلة للعملاء</span></p>
      </header>

      <div class="form-group">
        <input type="text" id="searchNotifications" placeholder="ابحث في الإشعارات...">
      </div>

      <div id="notificationsList" style="max-height: 400px; overflow-y: auto;">
        <div class="muted" style="text-align: center; padding: 20px;">
          <i class="fas fa-bell-slash" style="font-size: 2rem; margin-bottom: 10px;"></i>
          <p id="noNotificationsText">لا توجد إشعارات حتى الآن</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== الإعدادات =====
    const CONFIG = {
      sheetdbURL: "https://sheetdb.io/api/v1/m751x13jivenn",
      adminPassword: "850055",
      whatsappNumber: "963944807197"
    };

    // ===== حالة اللغة والترجمات =====
    let lang = "ar";
    const translations = {
      ar: {
        title: "بوابة الإدارة - Elite Trade",
        companyName: "Elite Trade",
        searchTabLabel: "بحث العملاء",
        adminTabLabel: "لوحة التحكم",
        userPassLabel: "كلمة المرور الخاصة بك",
        searchText: "بحث",
        copyText: "نسخ البيانات",
        printText: "طباعة",
        whatsappText: "واتساب",
        enterToSearch: "الرجاء إدخال كلمة المرور للبحث",
        notFound: "كلمة المرور غير موجودة",
        connectionError: "خطأ في الاتصال",
        copied: "تم نسخ البيانات بنجاح",
        privacy: "لن يتم حفظ بياناتك في هذا الموقع.",
        field: "العنوان",
        value: "القيمة",
        searching: "جاري البحث...",
        helpTitle: "كيف تستخدم النظام",
        help1: "أدخل كلمة المرور الخاصة بك",
        help2: "اضغط على زر البحث",
        help3: "استخدم الأزرار للنسخ أو الطباعة",
        help4: "شارك النتائج عبر واتساب",
        updateSuccess: "تم تحديث البيانات بنجاح",
        phoneRequired: "رقم الهاتف مطلوب",
        adminAccess: "تم الدخول إلى لوحة التحكم",
        adminDenied: "كلمة المرور غير صحيحة",
        adminPanelTitle: "لوحة تحكم المسؤول",
        adminPassLabel: "كلمة مرور المسؤول",
        adminLoginText: "تسجيل الدخول",
        searchClientTitle: "بحث عن العميل",
        clientSearchLabel: "كلمة مرور العميل",
        searchClientText: "بحث",
        clientInfoTitle: "معلومات العميل",
        clientNameLabel: "اسم العميل",
        clientPhoneLabel: "رقم الهاتف",
        clientEmailLabel: "البريد الإلكتروني",
        clientAddressLabel: "العنوان",
        clientStatusLabel: "حالة الطلب",
        clientNotesLabel: "ملاحظات",
        updateClientText: "حفظ التعديلات",
        notificationsTitle: "إشعارات التعديلات",
        notificationsSubtitle: "سجل إشعارات التعديلات المرسلة للعملاء",
        noNotificationsText: "لا توجد إشعارات حتى الآن",
        contractNumber: "رقم العقد",
        clientPassword: "كلمة المرور",
        userPasswordPlaceholder: "أدخل كلمة المرور الخاصة بك",
        adminPasswordPlaceholder: "أدخل كلمة مرور المسؤول",
        clientSearchPlaceholder: "ابحث بكلمة مرور العميل...",
        searchNotificationsPlaceholder: "ابحث في الإشعارات..."
      },
      en: {
        title: "Admin Portal - Elite Trade",
        companyName: "Elite Trade",
        searchTabLabel: "Search Clients",
        adminTabLabel: "Control Panel",
        userPassLabel: "Your Password",
        searchText: "Search",
        copyText: "Copy Data",
        printText: "Print",
        whatsappText: "WhatsApp",
        enterToSearch: "Please enter the password to search",
        notFound: "Password not found",
        connectionError: "Connection error",
        copied: "Data copied successfully",
        privacy: "Your data is not stored on this site.",
        field: "Field",
        value: "Value",
        searching: "Searching...",
        helpTitle: "How to use the system",
        help1: "Enter your password",
        help2: "Click the search button",
        help3: "Use buttons to copy or print",
        help4: "Share results via WhatsApp",
        updateSuccess: "Data updated successfully",
        phoneRequired: "Phone number is required",
        adminAccess: "Access granted to admin panel",
        adminDenied: "Incorrect password",
        adminPanelTitle: "Admin Control Panel",
        adminPassLabel: "Admin Password",
        adminLoginText: "Login",
        searchClientTitle: "Search for Client",
        clientSearchLabel: "Client Password",
        searchClientText: "Search",
        clientInfoTitle: "Client Information",
        clientNameLabel: "Client Name",
        clientPhoneLabel: "Phone Number",
        clientEmailLabel: "Email Address",
        clientAddressLabel: "Address",
        clientStatusLabel: "Order Status",
        clientNotesLabel: "Notes",
        updateClientText: "Save Changes",
        notificationsTitle: "Modification Notifications",
        notificationsSubtitle: "Record of modification notifications sent to clients",
        noNotificationsText: "No notifications yet",
        contractNumber: "Contract Number",
        clientPassword: "Password",
        userPasswordPlaceholder: "Enter your password",
        adminPasswordPlaceholder: "Enter admin password",
        clientSearchPlaceholder: "Search by client password...",
        searchNotificationsPlaceholder: "Search notifications..."
      },
      fr: {
        title: "Portail d'administration - Elite Trade",
        companyName: "Elite Trade",
        searchTabLabel: "Recherche Clients",
        adminTabLabel: "Panneau de Contrôle",
        userPassLabel: "Votre mot de passe",
        searchText: "Rechercher",
        copyText: "Copier les données",
        printText: "Imprimer",
        whatsappText: "WhatsApp",
        enterToSearch: "Veuillez entrer le mot de passe pour rechercher",
        notFound: "Mot de passe non trouvé",
        connectionError: "Erreur de connexion",
        copied: "Données copiées avec succès",
        privacy: "Vos données ne sont pas stockées sur ce site.",
        field: "Champ",
        value: "Valeur",
        searching: "Recherche en cours...",
        helpTitle: "Comment utiliser le système",
        help1: "Entrez votre mot de passe",
        help2: "Cliquez sur le bouton de recherche",
        help3: "Utilisez les boutons pour copier ou imprimer",
        help4: "Partagez les résultats via WhatsApp",
        updateSuccess: "Données mises à jour avec succès",
        phoneRequired: "Le numéro de téléphone est requis",
        adminAccess: "Accès accordé au panneau d'administration",
        adminDenied: "Mot de passe incorrect",
        adminPanelTitle: "Panneau de contrôle administrateur",
        adminPassLabel: "Mot de passe administrateur",
        adminLoginText: "Connexion",
        searchClientTitle: "Rechercher un client",
        clientSearchLabel: "Mot de passe client",
        searchClientText: "Rechercher",
        clientInfoTitle: "Informations client",
        clientNameLabel: "Nom du client",
        clientPhoneLabel: "Numéro de téléphone",
        clientEmailLabel: "Adresse e-mail",
        clientAddressLabel: "Adresse",
        clientStatusLabel: "Statut de la commande",
        clientNotesLabel: "Notes",
        updateClientText: "Enregistrer les modifications",
        notificationsTitle: "Notifications de modification",
        notificationsSubtitle: "Historique des notifications de modification envoyées aux clients",
        noNotificationsText: "Aucune notification pour le moment",
        contractNumber: "Numéro de contrat",
        clientPassword: "Mot de passe",
        userPasswordPlaceholder: "Entrez votre mot de passe",
        adminPasswordPlaceholder: "Entrez le mot de passe administrateur",
        clientSearchPlaceholder: "Rechercher par mot de passe client...",
        searchNotificationsPlaceholder: "Rechercher dans les notifications..."
      },
      ru: {
        title: "Панель управления - Elite Trade",
        companyName: "Elite Trade",
        searchTabLabel: "Поиск Клиентов",
        adminTabLabel: "Панель Управления",
        userPassLabel: "Ваш пароль",
        searchText: "Поиск",
        copyText: "Копировать данные",
        printText: "Печать",
        whatsappText: "WhatsApp",
        enterToSearch: "Пожалуйста, введите пароль для поиска",
        notFound: "Пароль не найден",
        connectionError: "Ошибка соединения",
        copied: "Данные успешно скопированы",
        privacy: "Ваши данные не сохраняются на этом сайте.",
        field: "Поле",
        value: "Значение",
        searching: "Поиск...",
        helpTitle: "Как использовать систему",
        help1: "Введите свой пароль",
        help2: "Нажмите кнопку поиска",
        help3: "Используйте кнопки для копирования или печати",
        help4: "Поделитесь результатами через WhatsApp",
        updateSuccess: "Данные успешно обновлены",
        phoneRequired: "Требуется номер телефона",
        adminAccess: "Доступ к панели управления предоставлен",
        adminDenied: "Неверный пароль",
        adminPanelTitle: "Панель управления администратора",
        adminPassLabel: "Пароль администратора",
        adminLoginText: "Войти",
        searchClientTitle: "Поиск клиента",
        clientSearchLabel: "Пароль клиента",
        searchClientText: "Поиск",
        clientInfoTitle: "Информация о клиенте",
        clientNameLabel: "Имя клиента",
        clientPhoneLabel: "Номер телефона",
        clientEmailLabel: "Адрес электронной почты",
        clientAddressLabel: "Адрес",
        clientStatusLabel: "Статус заказа",
        clientNotesLabel: "Примечания",
        updateClientText: "Сохранить изменения",
        notificationsTitle: "Уведомления об изменениях",
        notificationsSubtitle: "Запись уведомлений об изменениях, отправленных клиентам",
        noNotificationsText: "Пока нет уведомлений",
        contractNumber: "Номер контракта",
        clientPassword: "Пароль",
        userPasswordPlaceholder: "Введите ваш пароль",
        adminPasswordPlaceholder: "Введите пароль администратора",
        clientSearchPlaceholder: "Поиск по паролю клиента...",
        searchNotificationsPlaceholder: "Поиск в уведомлениях..."
      },
      id: {
        title: "Portal Admin - Elite Trade",
        companyName: "Elite Trade",
        searchTabLabel: "Pencarian Klien",
        adminTabLabel: "Panel Kontrol",
        userPassLabel: "Kata Sandi Anda",
        searchText: "Cari",
        copyText: "Salin Data",
        printText: "Cetak",
        whatsappText: "WhatsApp",
        enterToSearch: "Silakan masukkan kata sandi untuk mencari",
        notFound: "Kata sandi tidak ditemukan",
        connectionError: "Kesalahan koneksi",
        copied: "Data berhasil disalin",
        privacy: "Data Anda tidak disimpan di situs ini.",
        field: "Kolom",
        value: "Nilai",
        searching: "Mencari...",
        helpTitle: "Cara menggunakan sistem",
        help1: "Masukkan kata sandi Anda",
        help2: "Klik tombol pencarian",
        help3: "Gunakan tombol untuk menyalin atau mencetak",
        help4: "Bagikan hasil melalui WhatsApp",
        updateSuccess: "Data berhasil diperbarui",
        phoneRequired: "Nomor telepon diperlukan",
        adminAccess: "Akses diberikan ke panel admin",
        adminDenied: "Kata sandi salah",
        adminPanelTitle: "Panel Kontrol Admin",
        adminPassLabel: "Kata Sandi Admin",
        adminLoginText: "Masuk",
        searchClientTitle: "Cari Klien",
        clientSearchLabel: "Kata Sandi Klien",
        searchClientText: "Cari",
        clientInfoTitle: "Informasi Klien",
        clientNameLabel: "Nama Klien",
        clientPhoneLabel: "Nomor Telepon",
        clientEmailLabel: "Alamat Email",
        clientAddressLabel: "Alamat",
        clientStatusLabel: "Status Pesanan",
        clientNotesLabel: "Catatan",
        updateClientText: "Simpan Perubahan",
        notificationsTitle: "Notifikasi Modifikasi",
        notificationsSubtitle: "Catatan notifikasi modifikasi yang dikirim ke klien",
        noNotificationsText: "Belum ada notifikasi",
        contractNumber: "Nomor Kontrak",
        clientPassword: "Kata Sandi",
        userPasswordPlaceholder: "Masukkan kata sandi Anda",
        adminPasswordPlaceholder: "Masukkan kata sandi admin",
        clientSearchPlaceholder: "Cari dengan kata sandi klien...",
        searchNotificationsPlaceholder: "Cari notifikasi..."
      }
    };

    // ===== عناصر DOM =====
    const elements = {
      notification: document.getElementById('notification'),
      notificationText: document.getElementById('notification-text'),
      helpTrigger: document.getElementById('help-trigger'),
      helpPanel: document.getElementById('help-panel'),
      progressBar: document.getElementById('progressBar'),
      progress: document.querySelector('.progress'),
      resultContainer: document.getElementById('resultContainer'),
      title: document.getElementById('title'),
      companyName: document.getElementById('companyName'),
      searchTabLabel: document.getElementById('searchTabLabel'),
      adminTabLabel: document.getElementById('adminTabLabel'),
      userPassLabel: document.getElementById('userPassLabel'),
      searchText: document.getElementById('searchText'),
      copyText: document.getElementById('copyText'),
      printText: document.getElementById('printText'),
      whatsappText: document.getElementById('whatsappText'),
      userPassword: document.getElementById('userPassword'),
      toggleUser: document.getElementById('toggleUser'),
      searchBtn: document.getElementById('searchBtn'),
      status: document.getElementById('status'),
      result: document.getElementById('result'),
      copyBtn: document.getElementById('copyBtn'),
      printBtn: document.getElementById('printBtn'),
      whatsappBtn: document.getElementById('whatsappBtn'),
      privacyNote: document.getElementById('privacyText'),
      langButtons: document.querySelectorAll('.lang-btn'),
      tabs: document.querySelectorAll('.tab'),
      tabContents: document.querySelectorAll('.tab-content'),
      adminPassword: document.getElementById('adminPassword'),
      adminLoginBtn: document.getElementById('adminLoginBtn'),
      adminPanel: document.getElementById('adminPanel'),
      clientSearch: document.getElementById('clientSearch'),
      searchClientBtn: document.getElementById('searchClientBtn'),
      clientInfo: document.getElementById('clientInfo'),
      adminResult: document.getElementById('adminResult'),
      updateClientBtn: document.getElementById('updateClientBtn'),
      updateProgressBar: document.getElementById('updateProgressBar'),
      updateStatus: document.getElementById('updateStatus'),
      adminProgressBar: document.getElementById('adminProgressBar'),
      adminStatus: document.getElementById('adminStatus'),
      searchNotifications: document.getElementById('searchNotifications'),
      notificationsList: document.getElementById('notificationsList'),
      helpTitle: document.getElementById('helpTitle'),
      help1: document.getElementById('help1'),
      help2: document.getElementById('help2'),
      help3: document.getElementById('help3'),
      help4: document.getElementById('help4'),
      adminPanelTitle: document.getElementById('adminPanelTitle'),
      adminPassLabel: document.getElementById('adminPassLabel'),
      adminLoginText: document.getElementById('adminLoginText'),
      searchClientTitle: document.getElementById('searchClientTitle'),
      clientSearchLabel: document.getElementById('clientSearchLabel'),
      searchClientText: document.getElementById('searchClientText'),
      clientInfoTitle: document.getElementById('clientInfoTitle'),
      notificationsTitle: document.getElementById('notificationsTitle'),
      notificationsSubtitle: document.getElementById('notificationsSubtitle'),
      noNotificationsText: document.getElementById('noNotificationsText'),
      updateClientText: document.getElementById('updateClientText')
    };

    // ===== تطبيق الترجمة =====
    function applyTranslation() {
      const t = translations[lang];
      
      // تحديث جميع النصوص في الصفحة
      document.querySelectorAll('[id]').forEach(element => {
        const id = element.id;
        if (t[id] && element.textContent !== undefined) {
          element.textContent = t[id];
        }
      });
      
      // تحديث النصوص في عناصر المساعدة
      elements.helpTitle.textContent = t.helpTitle;
      elements.help1.textContent = t.help1;
      elements.help2.textContent = t.help2;
      elements.help3.textContent = t.help3;
      elements.help4.textContent = t.help4;
      
      // تحديث النصوص في لوحة التحكم
      elements.adminPanelTitle.textContent = t.adminPanelTitle;
      elements.adminPassLabel.textContent = t.adminPassLabel;
      elements.adminLoginText.textContent = t.adminLoginText;
      elements.searchClientTitle.textContent = t.searchClientTitle;
      elements.clientSearchLabel.textContent = t.clientSearchLabel;
      elements.searchClientText.textContent = t.searchClientText;
      elements.clientInfoTitle.textContent = t.clientInfoTitle;
      elements.updateClientText.textContent = t.updateClientText;
      elements.notificationsTitle.textContent = t.notificationsTitle;
      elements.notificationsSubtitle.textContent = t.notificationsSubtitle;
      elements.noNotificationsText.textContent = t.noNotificationsText;

      // تحديث النصوص الأخرى
      document.querySelectorAll('input, textarea').forEach(input => {
        const placeholderKey = input.id + 'Placeholder';
        if (t[placeholderKey]) {
          input.setAttribute('placeholder', t[placeholderKey]);
        }
      });

      // تحديث اتجاه الصفحة
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";
      
      // إعادة تطبيق الأنماط بناءً على اتجاه اللغة
      if (lang === "ar") {
        document.body.style.direction = "rtl";
        document.body.style.textAlign = "right";
      } else {
        document.body.style.direction = "ltr";
        document.body.style.textAlign = "left";
      }
    }

    // ===== عرض الإشعار =====
    function showNotification(message, type = 'success') {
      elements.notification.className = `notification ${type}`;
      elements.notificationText.textContent = message;
      elements.notification.classList.add('show');
      
      setTimeout(() => {
        elements.notification.classList.remove('show');
      }, 3000);
    }

    // ===== إظهار/إخفاء كلمة المرور =====
    function setupPasswordToggle() {
      elements.toggleUser.addEventListener('click', () => {
        const type = elements.userPassword.getAttribute('type') === 'password' ? 'text' : 'password';
        elements.userPassword.setAttribute('type', type);
        
        // تغيير الأيقونة
        const icon = elements.toggleUser.querySelector('i');
        icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
      });
    }

    // ===== البحث في SheetDB =====
    async function searchByPassword() {
      const t = translations[lang];
      const userPass = elements.userPassword.value.trim();

      if (!userPass) {
        showNotification(t.enterToSearch, 'error');
        elements.userPassword.focus();
        return;
      }

      // إظهار شريط التقدم
      elements.progressBar.style.display = 'block';
      elements.progress.style.width = '30%';
      
      // تحديث واجهة البحث
      elements.searchBtn.disabled = true;
      elements.searchBtn.innerHTML = `<div class="spinner"></div> ${t.searching}`;
      elements.status.textContent = t.searching;
      elements.resultContainer.style.display = 'none';

      try {
        const url = `${CONFIG.sheetdbURL}/search?password=${encodeURIComponent(userPass)}`;
        console.log("جاري البحث عن:", url);
        
        const res = await fetch(url, { method: "GET" });
        
        // تحديث شريط التقدم
        elements.progress.style.width = '70%';
        
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        console.log("البيانات المستلمة:", data);
        
        // إكمال شريط التقدم
        elements.progress.style.width = '100%';
        
        if (Array.isArray(data) && data.length > 0) {
          const row = data[0];
          console.log("بيانات العميل:", row);
          
          elements.result.innerHTML = buildTable(row);
          elements.resultContainer.style.display = 'block';
          elements.status.textContent = '';
          
          // إخفاء شريط التقدم بعد نجاح البحث
          setTimeout(() => {
            elements.progressBar.style.display = 'none';
          }, 500);
        } else {
          elements.status.textContent = t.notFound;
          showNotification(t.notFound, 'error');
        }
      } catch (e) {
        console.error("خطأ في البحث:", e);
        elements.status.textContent = t.connectionError;
        showNotification(t.connectionError + ": " + e.message, 'error');
      } finally {
        // إعادة تعيين واجهة البحث
        elements.searchBtn.disabled = false;
        elements.searchBtn.innerHTML = `<i class="fas fa-search"></i> ${t.searchText}`;
        
        // إخفاء شريط التقدم في حالة الخطأ
        setTimeout(() => {
            elements.progressBar.style.display = 'none';
        }, 1000);
      }
    }

    // ===== بناء جدول النتائج =====
    function buildTable(row) {
      const t = translations[lang];
      let html = `
        <div class="table-responsive">
          <table class="result-table">
            <thead>
              <tr>
                <th>${t.field}</th>
                <th>${t.value}</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      // عرض جميع حقول البيانات المتاحة
      for (const key in row) {
        if (row[key] !== undefined && row[key] !== null && row[key] !== '') {
          let fieldName = key;
          
          // تسمية الحقول بشكل مفهوم
          const fieldNames = {
            'A': t.contractNumber,
            'B': t.clientNameLabel, 
            'C': t.clientPhoneLabel,
            'D': t.clientEmailLabel,
            'E': t.clientAddressLabel,
            'F': t.clientPassword,
            'G': t.clientStatusLabel,
            'H': t.clientNotesLabel,
            'password': t.clientPassword,
            'name': t.clientNameLabel,
            'phone': t.clientPhoneLabel,
            'email': t.clientEmailLabel,
            'address': t.clientAddressLabel,
            'status': t.clientStatusLabel,
            'notes': t.clientNotesLabel
          };
          
          if (fieldNames[key]) {
            fieldName = fieldNames[key];
          }
          
          html += `
            <tr>
              <td><strong>${fieldName}</strong></td>
              <td>${escapeHtml(row[key])}</td>
            </tr>
          `;
        }
      }
      
      html += `
            </tbody>
          </table>
        </div>
      `;
      
      return html;
    }

    // ===== بناء جدول النتائج للوحة التحكم (قابل للتعديل) =====
    function buildAdminTable(row) {
      const t = translations[lang];
      let html = `
        <div class="table-responsive">
          <table class="admin-result-table">
            <thead>
              <tr>
                <th>${t.field}</th>
                <th>${t.value}</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      // عرض جميع حقول البيانات المتاحة
      for (const key in row) {
        if (row[key] !== undefined && row[key] !== null) {
          let fieldName = key;
          
          // تسمية الحقول بشكل مفهوم
          const fieldNames = {
            'A': t.contractNumber,
            'B': t.clientNameLabel, 
            'C': t.clientPhoneLabel,
            'D': t.clientEmailLabel,
            'E': t.clientAddressLabel,
            'F': t.clientPassword,
            'G': t.clientStatusLabel,
            'H': t.clientNotesLabel,
            'password': t.clientPassword,
            'name': t.clientNameLabel,
            'phone': t.clientPhoneLabel,
            'email': t.clientEmailLabel,
            'address': t.clientAddressLabel,
            'status': t.clientStatusLabel,
            'notes': t.clientNotesLabel
          };
          
          if (fieldNames[key]) {
            fieldName = fieldNames[key];
          }
          
          // حقول قابلة للتعديل
          let fieldValue = `
            <input type="text" id="admin_${key}" value="${escapeHtml(row[key] || '')}" data-field="${key}">
          `;
          
          // إذا كان الحقل هو الملاحظات، استخدم textarea
          if (key === 'H' || key === 'notes') {
            fieldValue = `
              <textarea id="admin_${key}" rows="3" data-field="${key}">${escapeHtml(row[key] || '')}</textarea>
            `;
          }
          
          html += `
            <tr>
              <td><strong>${fieldName}</strong></td>
              <td>${fieldValue}</td>
            </tr>
          `;
        }
      }
      
      html += `
            </tbody>
          </table>
        </div>
      `;
      
      return html;
    }

    // ===== هروب HTML =====
    function escapeHtml(s) {
      if (!s) return '';
      return s.toString().replace(/[&<>"']/g, c => ({
        "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
      }[c]));
    }

    // ===== النسخ، الطباعة، واتساب =====
    async function copyResult() {
      const t = translations[lang];
      const text = elements.result.innerText.trim();
      
      if (!text) {
        showNotification("لا توجد بيانات للنسخ", "error");
        return;
      }
      
      try {
        await navigator.clipboard.writeText(text);
        showNotification(t.copied, "success");
      } catch {
        // بديل للمتصفحات التي تمنع Clipboard API
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showNotification(t.copied, "success");
      }
    }

    function printResult() {
      const content = elements.result.innerHTML;
      
      if (!content.trim()) {
        showNotification("لا توجد بيانات للطباعة", "error");
        return;
      }
      
      const w = window.open("", "_blank");
      const styles = `
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          table { width: 100%; border-collapse: collapse; margin: 15px 0; }
          th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
          th { background-color: #f2f2f2; font-weight: bold; }
          tr:nth-child(even) { background-color: #f9f9f9; }
          h2 { color: #2c3e50; text-align: center; margin-bottom: 20px; }
          @media print {
            body { padding: 0; margin: 0; }
            table { width: 100%; }
          }
        </style>
      `;
      
      w.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <meta charset="UTF-8">
            <title>بيانات العميل - Elite Trade</title>
            ${styles}
          </head>
          <body>
            <h2>بيانات العميل - Elite Trade</h2>
            ${content}
          </body>
        </html>
      `);
      
      w.document.close();
      w.focus();
      w.print();
      w.close();
    }

    function sendWhatsApp() {
      const text = elements.result.innerText.trim();
      
      if (!text) {
        showNotification("لا توجد بيانات للمشاركة", "error");
        return;
      }
      
      const msg = encodeURIComponent(text);
      window.open(`https://wa.me/${CONFIG.whatsappNumber}?text=${msg}`, "_blank");
    }

    // ===== إدارة المسؤولين =====
    function adminLogin() {
      const password = elements.adminPassword.value.trim();
      const t = translations[lang];
      
      if (password === CONFIG.adminPassword) {
        elements.adminPanel.style.display = 'block';
        showNotification(t.adminAccess, 'success');
      } else {
        showNotification(t.adminDenied, 'error');
      }
    }

    // ===== البحث عن العميل في لوحة التحكم =====
    async function searchClient() {
      const t = translations[lang];
      const clientPass = elements.clientSearch.value.trim();

      if (!clientPass) {
        showNotification(t.enterToSearch, 'error');
        elements.clientSearch.focus();
        return;
      }

      // إظهار شريط التقدم
      elements.adminProgressBar.style.display = 'block';
      elements.adminProgressBar.querySelector('.progress').style.width = '30%';
      
      // تحديث واجهة البحث
      elements.searchClientBtn.disabled = true;
      elements.searchClientBtn.innerHTML = `<div class="spinner"></div> ${t.searching}`;
      elements.adminStatus.textContent = t.searching;
      elements.clientInfo.style.display = 'none';

      try {
        const url = `${CONFIG.sheetdbURL}/search?password=${encodeURIComponent(clientPass)}`;
        console.log("جاري البحث في لوحة التحكم:", url);
        
        const res = await fetch(url, { method: "GET" });
        
        // تحديث شريط التقدم
        elements.adminProgressBar.querySelector('.progress').style.width = '70%';
        
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        console.log("البيانات المستلمة في لوحة التحكم:", data);
        
        // إكمال شريط التقدم
        elements.adminProgressBar.querySelector('.progress').style.width = '100%';
        
        if (Array.isArray(data) && data.length > 0) {
          const client = data[0];
          
          // تخزين معرف العميل للاستخدام لاحقاً
          elements.clientInfo.dataset.clientId = client.A; // العمود A: رقم العقد
          
          // بناء جدول البيانات القابل للتعديل
          elements.adminResult.innerHTML = buildAdminTable(client);
          
          // إظهار معلومات العميل
          elements.clientInfo.style.display = 'block';
          elements.adminStatus.textContent = '';
          
          showNotification("تم العثور على العميل", 'success');
        } else {
          elements.adminStatus.textContent = t.notFound;
          showNotification(t.notFound, 'error');
        }
      } catch (e) {
        console.error("خطأ في البحث في لوحة التحكم:", e);
        elements.adminStatus.textContent = t.connectionError;
        showNotification(t.connectionError, 'error');
      } finally {
        // إعادة تعيين واجهة البحث
        elements.searchClientBtn.disabled = false;
        elements.searchClientBtn.innerHTML = `<i class="fas fa-search"></i> ${t.searchClientText}`;
        
        // إخفاء شريط التقدم في حالة الخطأ
        setTimeout(() => {
          elements.adminProgressBar.style.display = 'none';
        }, 1000);
      }
    }

    // ===== تحديث بيانات العميل =====
    async function updateClient() {
      const t = translations[lang];
      const clientId = elements.clientInfo.dataset.clientId;
      
      if (!clientId) {
        showNotification("يرجى البحث عن عميل أولاً", "error");
        return;
      }

      // إظهار شريط التقدم
      elements.updateProgressBar.style.display = 'block';
      elements.updateProgressBar.querySelector('.progress').style.width = '30%';
      
      // تحديث واجهة التحديث
      elements.updateClientBtn.disabled = true;
      elements.updateClientBtn.innerHTML = `<div class="spinner"></div> جاري الحفظ...`;
      elements.updateStatus.textContent = "جاري حفظ التعديلات...";

      try {
        // جمع البيانات من الحقول القابلة للتعديل
        const dataToUpdate = {};
        
        // جمع جميع الحقول من الجدول
        document.querySelectorAll('#adminResult input, #adminResult textarea').forEach(field => {
          const fieldName = field.getAttribute('data-field');
          const fieldValue = field.value;
          dataToUpdate[fieldName] = fieldValue;
        });
        
        // إنشاء الكائن بالهيكل المطلوب من SheetDB
        const updateData = {
          data: dataToUpdate
        };
        
        console.log("بيانات التحديث:", updateData);
        
        // تحديث البيانات في SheetDB باستخدام رقم العقد (العمود A)
        const updateUrl = `${CONFIG.sheetdbURL}/A/${encodeURIComponent(clientId)}`;
        console.log("جاري التحديث إلى:", updateUrl);
        
        const updateRes = await fetch(updateUrl, {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(updateData)
        });
        
        const responseData = await updateRes.json();
        console.log("استجابة التحديث:", responseData);
        
        if (!updateRes.ok) {
          throw new Error(responseData.error || "فشل في تحديث البيانات");
        }

        // إكمال شريط التقدم
        elements.updateProgressBar.querySelector('.progress').style.width = '100%';
        
        showNotification(t.updateSuccess, "success");
        elements.updateStatus.textContent = "تم حفظ التعديلات بنجاح";
        
        // إضافة إشعار
        addNotification({
          client: dataToUpdate.B || 'غير معروف',
          phone: dataToUpdate.C || 'غير معروف',
          field: 'جميع الحقول',
          message: 'تم تحديث بيانات العميل',
          date: new Date().toLocaleString()
        });

      } catch (e) {
        console.error("خطأ في التحديث:", e);
        elements.updateStatus.textContent = e.message;
        showNotification(e.message, "error");
      } finally {
        // إعادة تعيين واجهة التحديث
        elements.updateClientBtn.disabled = false;
        elements.updateClientBtn.innerHTML = `<i class="fas fa-save"></i> ${t.updateClientText}`;
        
        // إخفاء شريط التقدم
        setTimeout(() => {
          elements.updateProgressBar.style.display = 'none';
        }, 1000);
      }
    }

    // ===== إدارة الإشعارات =====
    function addNotification(notification) {
      let notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
      notifications.unshift(notification);
      localStorage.setItem('notifications', JSON.stringify(notifications));
      
      renderNotifications();
    }

    function renderNotifications() {
      const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
      const searchTerm = elements.searchNotifications.value.toLowerCase();
      
      if (notifications.length === 0) {
        elements.notificationsList.innerHTML = `
          <div class="muted" style="text-align: center; padding: 20px;">
            <i class="fas fa-bell-slash" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>${translations[lang].noNotificationsText}</p>
          </div>
        `;
        return;
      }
      
      let filteredNotifications = notifications;
      if (searchTerm) {
        filteredNotifications = notifications.filter(n => 
          (n.client && n.client.toLowerCase().includes(searchTerm)) || 
          (n.field && n.field.toLowerCase().includes(searchTerm)) ||
          (n.message && n.message.toLowerCase().includes(searchTerm))
        );
      }
      
      let html = '';
      filteredNotifications.forEach(notif => {
        html += `
          <div style="padding: 15px; border-bottom: 1px solid #eee;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <strong>${notif.client || 'عميل غير معروف'}</strong>
              <span style="color: var(--text-secondary); font-size: 0.9em;">${notif.date || ''}</span>
            </div>
            <div style="margin-bottom: 5px;">
              <span style="background: #f1f5f9; padding: 3px 8px; border-radius: 4px; font-size: 0.9em;">
                ${notif.field || 'حقل غير معروف'}
              </span>
            </div>
            <div>${notif.message || 'لا توجد رسالة'}</div>
            <div style="color: var(--text-secondary); font-size: 0.9em; margin-top: 5px;">
              <i class="fas fa-phone"></i> ${notif.phone || 'لا يوجد رقم'}
            </div>
          </div>
        `;
      });
      
      elements.notificationsList.innerHTML = html;
    }

    // ===== تهيئة الصفحة =====
    function init() {
      // تطبيق الترجمة
      applyTranslation();
      
      // إعداد تبديل كلمة المرور
      setupPasswordToggle();
      
      // أحداث الأزرار
      elements.searchBtn.addEventListener('click', searchByPassword);
      elements.copyBtn.addEventListener('click', copyResult);
      elements.printBtn.addEventListener('click', printResult);
      elements.whatsappBtn.addEventListener('click', sendWhatsApp);
      elements.adminLoginBtn.addEventListener('click', adminLogin);
      elements.searchClientBtn.addEventListener('click', searchClient);
      elements.updateClientBtn.addEventListener('click', updateClient);
      
      // البحث عند الضغط على Enter
      elements.userPassword.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchByPassword();
      });
      
      elements.adminPassword.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') adminLogin();
      });
      
      elements.clientSearch.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchClient();
      });
      
      // تبديل اللغات
      elements.langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          elements.langButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          lang = btn.dataset.lang;
          localStorage.setItem('lang', lang);
          applyTranslation();
        });
      });
      
      // التبديل بين التبويبات
      elements.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          
          // إزالة النشاط من جميع التبويبات والمحتويات
          elements.tabs.forEach(t => t.classList.remove('active'));
          elements.tabContents.forEach(c => c.classList.remove('active'));
          
          // إضافة النشاط للتبويب والمحتوى المحدد
          tab.classList.add('active');
          document.getElementById(`${tabName}Tab`).classList.add('active');
        });
      });
      
      // فتح/إغلاق panel المساعدة
      elements.helpTrigger.addEventListener('click', () => {
        elements.helpPanel.classList.toggle('show');
      });
      
      // إغلاق panel المساعدة عند النقر خارجها
      document.addEventListener('click', (e) => {
        if (!elements.helpPanel.contains(e.target) && !elements.helpTrigger.contains(e.target)) {
          elements.helpPanel.classList.remove('show');
        }
      });
      
      // البحث في الإشعارات
      elements.searchNotifications.addEventListener('input', renderNotifications);
      
      // تحميل الإشعارات عند البدء
      renderNotifications();
      
      // تحميل اللغة المحفوظة
      const savedLang = localStorage.getItem('lang');
      if (savedLang) {
        lang = savedLang;
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.lang === lang);
        });
        applyTranslation();
      }
    }

    // بدء التحميل
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>